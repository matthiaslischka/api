= Nobt.io API Documentation
Thomas Eizinger;
:doctype: book
:icons: font
:source-highlighter: highlightjs

This document describes the API of Nobt.io. There are 3 requests that can be made at the moment:

* Create a new nobt
* Add an expense to a given nobt
* Retrieve the nobt

== Domain glossary

The most important domain terms are:

include::domain-glossary.adoc[]

== Create a new nobt

To create a new nobt, issue an http request like this:

include::{snippets}/create-nobt/http-request.adoc[]
include::{snippets}/create-nobt/request-fields.adoc[]

The response looks like this:

include::{snippets}/create-nobt/http-response.adoc[]

In addition to the information that was sent to the API, two arrays are returned. `expenses` and `transaction`. We will look into those further after we have added an expense to this nobt and retrieved it again.

== Add an expense to a nobt

Creating an expense requires some client logic as the API only accepts `shares` of an expense.
The client must split the overall amount of the expense in shares consisting of the name of the debtor and the associated amount.
The sum of all amounts of all shares forms the overall amount of the expense.

This design allows the client to present the user with several possibilities to split his expense. For example:

- Split by percentage
- Split evenly among debtors
- Split by weighted shares
- Custom value per debtor

The client may store an identifier in the `splitStrategy` field for each expense that identifies the way the shares have been calculated.

Given the url in the `Location` header that was returned in the previous response, we can add an expense to this nobt if we post an expense to the `/expenses` sub-resource.

include::{snippets}/create-expense/http-request.adoc[]
include::{snippets}/create-expense/request-fields.adoc[]

The request was successful if the server returns a status-code of 201. For convenience, the response includes the sent data.

include::{snippets}/create-expense/http-response.adoc[]

Sending a faulty request results in a status-code of 400. In the case of creating an expense for a nobt, this occurs if the same debtor (identified by the name), occurs twice in the list of shares for an expense.

An example for such a faulty request would be:

include::{snippets}/duplicate-debtor/http-request.adoc[]

The response in the case of an validation failure is:

include::{snippets}/duplicate-debtor/http-response.adoc[]
include::{snippets}/duplicate-debtor/response-fields.adoc[]

== Retrieve the nobt

Once we add at least one expense, it makes sense to re-retrieve the nobt we created before.

include::{snippets}/get-nobt/http-request.adoc[]

This time, the response is way more interesting, as it includes transactions.

include::{snippets}/get-nobt/http-response.adoc[]
include::{snippets}/get-nobt/response-fields.adoc[]

== Delete an expense

Deleting an expense is as easy as sending a `DELETE` request to the `/expense` sub-resource with the appropriate id.

include::{snippets}/delete-expense/http-request.adoc[]

The response code is always `204 NO CONTENT`, even if there was no response with the specified ID.

include::{snippets}/delete-expense/http-response.adoc[]